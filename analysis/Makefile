# Analyses Makefile

.PHONY: all

# Variables
STEMS=data/clean_input_data.Rdata
PLOTS=data/seosaw_plot_summary5Apr2019.Rdata

# Main
# When the master data, or the scripts change, recompile models
all: plot_data_descrip.R lmm.R sem.R data/plot_data_fil_agg_norm_std_outlier.csv data/region_temp_precip.csv
	Rscript plot_data_descrip.R
	Rscript cluster_species.R
	Rscript lmm.R
	Rscript sem.R
	./img_transfer.sh

# Data collation
# When any of the scripts or the prelim data change, recompile master dataset

# Remove compositional outliers
data/plot_data_fil_agg_norm_std_outlier.csv: compositional_outliers.R data/plot_data_fil_agg_norm_std.csv data/plotcode_plot_group_lookup.csv $(STEMS)
	Rscript compositional_outliers.R

# Normalise the data
data/plot_data_fil_agg_norm_std.csv: bivar_rel_norm.R data/plot_data_fil_agg.csv 
	mkdir -p output
	Rscript bivar_rel_norm.R 

# Aggregate the data
data/plot_data_fil_agg.csv: plot_data_collation.R data/seosaw_aridity_index.csv data/fire_return.csv data/seosaw_ocdens.csv $(PLOTS) $(STEMS)
	Rscript plot_data_collation.R

# Get regional climate space
data/region_temp_precip.csv: data/wc2.0_30s_tavg/* data/wc2.0_30s_prec/*
	Rscript temp_precip_region.R

# Process aridity data
data/seosaw_aridity_index.csv: aridity_index_seosaw.R data/ai_et0_crop/ai_et0_crop.tif $(PLOTS) 
	Rscript aridity_index_seosaw.R

# Crop aridity geoTIFF
# data/ai_et0_crop/ai_et0_crop.tif: data/ai_et0/ai_et0.tif ai_crop.sh $(PLOTS)
#	mkdir -p data/ai_et0_crop/
#	./ai_crop.sh

data/seosaw_ocdens.csv: soil_carbon.R data/OCDENS_M_sl2_250m_ll_crop.tif $(PLOTS) 
	Rscript soil_carbon.R

# fire_return.csv was generated by scripts held on burn, due to the large amount of data
